Using gpu device 0: GRID K520 (CNMeM is enabled)
/home/ubuntu/.local/lib/python2.7/site-packages/theano/tensor/signal/downsample.py:5: UserWarning: downsample module has been moved to the pool module.
  warnings.warn("downsample module has been moved to the pool module.")
Loading data...
loading training data for synset 20 / 100
loading training data for synset 40 / 100
loading training data for synset 60 / 100
loading training data for synset 80 / 100
loading training data for synset 100 / 100
Building model and compiling functions...
ResNet
number of parameters in model: 21154468
Starting training...
Epoch 1 of 90 took 14.520m
  training loss:		7.091099
  validation loss:		3.878209
  validation accuracy:		11.90 %
 top 5 validation accuracy:		34.46 %
Epoch 2 of 90 took 14.456m
  training loss:		5.665105
  validation loss:		3.427996
  validation accuracy:		20.28 %
 top 5 validation accuracy:		47.88 %
Epoch 3 of 90 took 14.514m
  training loss:		5.010685
  validation loss:		3.124187
  validation accuracy:		26.20 %
 top 5 validation accuracy:		53.62 %
Epoch 4 of 90 took 14.520m
  training loss:		4.530563
  validation loss:		2.870210
  validation accuracy:		29.54 %
 top 5 validation accuracy:		59.38 %
Epoch 5 of 90 took 14.515m
  training loss:		4.152912
  validation loss:		2.910266
  validation accuracy:		31.36 %
 top 5 validation accuracy:		59.92 %
Epoch 6 of 90 took 14.516m
  training loss:		3.831706
  validation loss:		2.657945
  validation accuracy:		34.90 %
 top 5 validation accuracy:		64.60 %
Epoch 7 of 90 took 14.520m
  training loss:		3.560870
  validation loss:		2.668609
  validation accuracy:		35.38 %
 top 5 validation accuracy:		63.86 %
New LR:0.0995000014827
Epoch 8 of 90 took 14.453m
  training loss:		3.329166
  validation loss:		2.514946
  validation accuracy:		37.34 %
 top 5 validation accuracy:		67.66 %
Epoch 9 of 90 took 14.513m
  training loss:		3.122128
  validation loss:		2.468436
  validation accuracy:		39.48 %
 top 5 validation accuracy:		68.56 %
Epoch 10 of 90 took 14.512m
  training loss:		2.946275
  validation loss:		2.346549
  validation accuracy:		42.92 %
 top 5 validation accuracy:		71.02 %
Epoch 11 of 90 took 14.518m
  training loss:		2.799148
  validation loss:		2.269152
  validation accuracy:		43.72 %
 top 5 validation accuracy:		72.62 %
Epoch 12 of 90 took 14.513m
  training loss:		2.660579
  validation loss:		2.271903
  validation accuracy:		44.28 %
 top 5 validation accuracy:		72.54 %
Epoch 13 of 90 took 14.512m
  training loss:		2.559647
  validation loss:		2.227110
  validation accuracy:		45.64 %
 top 5 validation accuracy:		73.12 %
Epoch 14 of 90 took 14.508m
  training loss:		2.475705
  validation loss:		2.201554
  validation accuracy:		46.40 %
 top 5 validation accuracy:		74.24 %
Epoch 15 of 90 took 14.504m
  training loss:		2.386010
  validation loss:		2.287302
  validation accuracy:		46.00 %
 top 5 validation accuracy:		73.36 %
New LR:0.0990025004745
Epoch 16 of 90 took 14.509m
  training loss:		2.325984
  validation loss:		2.377422
  validation accuracy:		44.80 %
 top 5 validation accuracy:		72.20 %
New LR:0.0985074903443
Epoch 17 of 90 took 14.512m
  training loss:		2.268435
  validation loss:		2.331974
  validation accuracy:		45.94 %
 top 5 validation accuracy:		74.26 %
New LR:0.0980149562657
Epoch 18 of 90 took 14.505m
  training loss:		2.223508
  validation loss:		2.293188
  validation accuracy:		46.64 %
 top 5 validation accuracy:		73.64 %
New LR:0.0975248834118
Epoch 19 of 90 took 14.504m
  training loss:		2.195740
  validation loss:		2.499093
  validation accuracy:		45.12 %
 top 5 validation accuracy:		71.90 %
New LR:0.0970372569561
Epoch 20 of 90 took 14.508m
  training loss:		2.161494
  validation loss:		2.419472
  validation accuracy:		47.46 %
 top 5 validation accuracy:		73.44 %
Epoch 21 of 90 took 14.509m
  training loss:		2.139874
  validation loss:		2.368152
  validation accuracy:		48.26 %
 top 5 validation accuracy:		74.40 %
Epoch 22 of 90 took 14.507m
  training loss:		2.113749
  validation loss:		2.444082
  validation accuracy:		46.66 %
 top 5 validation accuracy:		74.02 %
New LR:0.0965520694852
Epoch 23 of 90 took 14.510m
  training loss:		2.098767
  validation loss:		2.374024
  validation accuracy:		47.80 %
 top 5 validation accuracy:		74.32 %
New LR:0.0960693061724
Epoch 24 of 90 took 14.508m
  training loss:		2.094218
  validation loss:		2.547498
  validation accuracy:		46.68 %
 top 5 validation accuracy:		73.80 %
New LR:0.0955889596045
Epoch 25 of 90 took 14.509m
  training loss:		2.090297
  validation loss:		2.545553
  validation accuracy:		47.08 %
 top 5 validation accuracy:		74.44 %
New LR:0.0951110149547
Epoch 26 of 90 took 14.509m
  training loss:		2.048314
  validation loss:		2.766213
  validation accuracy:		45.92 %
 top 5 validation accuracy:		71.54 %
New LR:0.0946354573965
Epoch 27 of 90 took 14.510m
  training loss:		2.047881
  validation loss:		2.477167
  validation accuracy:		49.24 %
 top 5 validation accuracy:		74.30 %
Epoch 28 of 90 took 14.505m
  training loss:		2.074839
  validation loss:		2.576073
  validation accuracy:		47.38 %
 top 5 validation accuracy:		73.00 %
New LR:0.0941622795165
Epoch 29 of 90 took 14.506m
  training loss:		2.031715
  validation loss:		2.750977
  validation accuracy:		45.62 %
 top 5 validation accuracy:		73.54 %
New LR:0.0936914664879
Epoch 30 of 90 took 14.512m
  training loss:		2.056639
  validation loss:		2.696707
  validation accuracy:		47.78 %
 top 5 validation accuracy:		73.28 %
New LR:0.0932230108976
Epoch 31 of 90 took 14.511m
  training loss:		2.020275
  validation loss:		2.789477
  validation accuracy:		46.76 %
 top 5 validation accuracy:		72.84 %
New LR:0.0927568979189
Epoch 32 of 90 took 14.510m
  training loss:		2.017718
  validation loss:		2.666288
  validation accuracy:		47.62 %
 top 5 validation accuracy:		73.60 %
New LR:0.092293112725
Epoch 33 of 90 took 14.507m
  training loss:		2.020320
  validation loss:		2.609749
  validation accuracy:		48.52 %
 top 5 validation accuracy:		74.32 %
New LR:0.0918316479027
Epoch 34 of 90 took 14.507m
  training loss:		1.991463
  validation loss:		2.711522
  validation accuracy:		48.14 %
 top 5 validation accuracy:		73.48 %
New LR:0.0913724886253
Epoch 35 of 90 took 14.508m
  training loss:		1.997792
  validation loss:		2.638176
  validation accuracy:		49.84 %
 top 5 validation accuracy:		74.72 %
Epoch 36 of 90 took 14.509m
  training loss:		1.984332
  validation loss:		2.675561
  validation accuracy:		48.86 %
 top 5 validation accuracy:		74.82 %
New LR:0.0909156274796
Epoch 37 of 90 took 14.509m
  training loss:		1.994533
  validation loss:		2.711547
  validation accuracy:		46.92 %
 top 5 validation accuracy:		73.88 %
New LR:0.0904610496387
Epoch 38 of 90 took 14.502m
  training loss:		1.946429
  validation loss:		2.842172
  validation accuracy:		46.92 %
 top 5 validation accuracy:		73.18 %
New LR:0.0900087476894
Epoch 39 of 90 took 14.505m
  training loss:		1.959334
  validation loss:		2.704337
  validation accuracy:		48.78 %
 top 5 validation accuracy:		74.16 %
New LR:0.0895587068051
Epoch 40 of 90 took 14.507m
  training loss:		1.936873
  validation loss:		2.784097
  validation accuracy:		48.84 %
 top 5 validation accuracy:		74.18 %
New LR:0.0891109121591
Epoch 41 of 90 took 14.510m
  training loss:		1.939501
  validation loss:		2.645392
  validation accuracy:		50.06 %
 top 5 validation accuracy:		75.32 %
New LR:0.088665356338
Epoch 42 of 90 took 14.507m
  training loss:		1.897549
  validation loss:		2.706565
  validation accuracy:		48.54 %
 top 5 validation accuracy:		74.40 %
New LR:0.0882220319286
Epoch 43 of 90 took 14.507m
  training loss:		1.898010
  validation loss:		2.680294
  validation accuracy:		49.28 %
 top 5 validation accuracy:		74.18 %
New LR:0.0877809241042
Epoch 44 of 90 took 14.509m
  training loss:		1.907878
  validation loss:		2.721226
  validation accuracy:		49.48 %
 top 5 validation accuracy:		75.20 %
New LR:0.087342018038
Epoch 45 of 90 took 14.513m
  training loss:		1.887681
  validation loss:		2.701586
  validation accuracy:		50.06 %
 top 5 validation accuracy:		74.40 %
New LR:0.0869053063169
Epoch 46 of 90 took 14.506m
  training loss:		1.886460
  validation loss:		2.775551
  validation accuracy:		49.24 %
 top 5 validation accuracy:		74.52 %
New LR:0.0864707815275
Epoch 47 of 90 took 14.508m
  training loss:		1.877194
  validation loss:		2.769665
  validation accuracy:		50.34 %
 top 5 validation accuracy:		74.94 %
New LR:0.086038428843
Epoch 48 of 90 took 14.512m
  training loss:		1.850700
  validation loss:		2.903373
  validation accuracy:		48.38 %
 top 5 validation accuracy:		73.56 %
New LR:0.0856082334369
Epoch 49 of 90 took 14.507m
  training loss:		1.855485
  validation loss:		2.786014
  validation accuracy:		49.46 %
 top 5 validation accuracy:		75.02 %
New LR:0.0851801953092
Epoch 50 of 90 took 14.505m
  training loss:		1.853194
  validation loss:		2.977701
  validation accuracy:		47.00 %
 top 5 validation accuracy:		72.84 %
New LR:0.0847542922199
Epoch 51 of 90 took 14.505m
  training loss:		1.833665
  validation loss:		2.906750
  validation accuracy:		48.08 %
 top 5 validation accuracy:		74.34 %
New LR:0.0843305241689
Epoch 52 of 90 took 14.506m
  training loss:		1.818152
  validation loss:		2.755750
  validation accuracy:		50.38 %
 top 5 validation accuracy:		74.44 %
New LR:0.0839088689163
Epoch 53 of 90 took 14.508m
  training loss:		1.812298
  validation loss:		2.817621
  validation accuracy:		48.16 %
 top 5 validation accuracy:		74.14 %
New LR:0.0834893264621
Epoch 54 of 90 took 14.512m
  training loss:		1.807365
  validation loss:		2.699886
  validation accuracy:		49.52 %
 top 5 validation accuracy:		75.40 %
New LR:0.0830718819797
Epoch 55 of 90 took 14.512m
  training loss:		1.786629
  validation loss:		2.810750
  validation accuracy:		48.98 %
 top 5 validation accuracy:		74.78 %
New LR:0.0826565206423
Epoch 56 of 90 took 14.507m
  training loss:		1.789810
  validation loss:		2.727603
  validation accuracy:		49.80 %
 top 5 validation accuracy:		75.80 %
New LR:0.0822432350367
Epoch 57 of 90 took 14.507m
  training loss:		1.792964
  validation loss:		2.823040
  validation accuracy:		48.36 %
 top 5 validation accuracy:		73.46 %
New LR:0.0818320177495
Epoch 58 of 90 took 14.505m
  training loss:		1.770714
  validation loss:		2.744239
  validation accuracy:		49.60 %
 top 5 validation accuracy:		75.26 %
New LR:0.0814228613675
Epoch 59 of 90 took 14.509m
  training loss:		1.741483
  validation loss:		2.790674
  validation accuracy:		49.64 %
 top 5 validation accuracy:		74.76 %
New LR:0.0810157436505
Epoch 60 of 90 took 14.512m
  training loss:		1.740853
  validation loss:		2.588189
  validation accuracy:		49.88 %
 top 5 validation accuracy:		75.66 %
New LR:0.0806106645986
Epoch 61 of 90 took 14.511m
  training loss:		1.736968
  validation loss:		2.815269
  validation accuracy:		49.54 %
 top 5 validation accuracy:		74.74 %
New LR:0.00806106626987
New LR:0.00802076093853
Epoch 62 of 90 took 14.500m
  training loss:		1.565626
  validation loss:		2.205083
  validation accuracy:		56.46 %
 top 5 validation accuracy:		80.42 %
Epoch 63 of 90 took 14.509m
  training loss:		1.450096
  validation loss:		2.146266
  validation accuracy:		58.00 %
 top 5 validation accuracy:		80.90 %
Epoch 64 of 90 took 14.509m
  training loss:		1.416174
  validation loss:		2.146829
  validation accuracy:		58.04 %
 top 5 validation accuracy:		80.98 %
New LR:0.00798065668903
Epoch 65 of 90 took 14.499m
  training loss:		1.391212
  validation loss:		2.147252
  validation accuracy:		58.18 %
 top 5 validation accuracy:		81.08 %
New LR:0.00794075352605
Epoch 66 of 90 took 14.496m
  training loss:		1.371787
  validation loss:		2.136800
  validation accuracy:		58.58 %
 top 5 validation accuracy:		81.44 %
New LR:0.00790104959626
Epoch 67 of 90 took 14.503m
  training loss:		1.350728
  validation loss:		2.125689
  validation accuracy:		59.06 %
 top 5 validation accuracy:		81.38 %
New LR:0.00786154397298
Epoch 68 of 90 took 14.448m
  training loss:		1.333455
  validation loss:		2.118291
  validation accuracy:		59.00 %
 top 5 validation accuracy:		81.76 %
New LR:0.00782223665621
Epoch 69 of 90 took 14.511m
  training loss:		1.316061
  validation loss:		2.116210
  validation accuracy:		58.80 %
 top 5 validation accuracy:		81.52 %
New LR:0.00778312579263
Epoch 70 of 90 took 14.510m
  training loss:		1.299696
  validation loss:		2.120352
  validation accuracy:		58.78 %
 top 5 validation accuracy:		81.50 %
New LR:0.00774420999223
Epoch 71 of 90 took 14.510m
  training loss:		1.284304
  validation loss:		2.109818
  validation accuracy:		58.84 %
 top 5 validation accuracy:		81.76 %
New LR:0.00770548879169
Epoch 72 of 90 took 14.507m
  training loss:		1.268571
  validation loss:		2.107286
  validation accuracy:		59.04 %
 top 5 validation accuracy:		81.74 %
New LR:0.00766696126433
Epoch 73 of 90 took 14.509m
  training loss:		1.253369
  validation loss:		2.111375
  validation accuracy:		59.04 %
 top 5 validation accuracy:		81.42 %
New LR:0.00762862648349
Epoch 74 of 90 took 14.509m
  training loss:		1.238233
  validation loss:		2.095565
  validation accuracy:		58.88 %
 top 5 validation accuracy:		81.76 %
New LR:0.00759048352251
Epoch 75 of 90 took 14.507m
  training loss:		1.224495
  validation loss:		2.099971
  validation accuracy:		59.18 %
 top 5 validation accuracy:		81.74 %
New LR:0.000759048340842
New LR:0.000755253087555
Epoch 76 of 90 took 14.509m
  training loss:		1.215528
  validation loss:		2.091007
  validation accuracy:		58.92 %
 top 5 validation accuracy:		81.44 %
New LR:0.000751476807927
Epoch 77 of 90 took 14.512m
  training loss:		1.214272
  validation loss:		2.089203
  validation accuracy:		58.86 %
 top 5 validation accuracy:		81.58 %
New LR:0.000747719409119
Epoch 78 of 90 took 14.510m
  training loss:		1.212782
  validation loss:		2.091303
  validation accuracy:		59.00 %
 top 5 validation accuracy:		81.64 %
New LR:0.000743980833213
Epoch 79 of 90 took 14.507m
  training loss:		1.211753
  validation loss:		2.089437
  validation accuracy:		58.96 %
 top 5 validation accuracy:		81.46 %
New LR:0.000740260906459
Epoch 80 of 90 took 14.509m
  training loss:		1.210113
  validation loss:		2.084235
  validation accuracy:		59.08 %
 top 5 validation accuracy:		81.66 %
New LR:0.000736559628858
Epoch 81 of 90 took 14.497m
  training loss:		1.208214
  validation loss:		2.092253
  validation accuracy:		58.82 %
 top 5 validation accuracy:		81.54 %
New LR:0.00073287682666
Epoch 82 of 90 took 14.509m
  training loss:		1.207103
  validation loss:		2.085869
  validation accuracy:		59.34 %
 top 5 validation accuracy:		81.56 %
New LR:0.000729212441947
Epoch 83 of 90 took 14.508m
  training loss:		1.205982
  validation loss:		2.085558
  validation accuracy:		59.14 %
 top 5 validation accuracy:		81.62 %
New LR:0.000725566358888
Epoch 84 of 90 took 14.513m
  training loss:		1.204407
  validation loss:		2.088111
  validation accuracy:		59.24 %
 top 5 validation accuracy:		81.78 %
New LR:0.000721938519564
Epoch 85 of 90 took 14.513m
  training loss:		1.203046
  validation loss:		2.078887
  validation accuracy:		59.22 %
 top 5 validation accuracy:		81.58 %
New LR:0.000718328808143
Epoch 86 of 90 took 14.511m
  training loss:		1.201563
  validation loss:		2.074275
  validation accuracy:		59.42 %
 top 5 validation accuracy:		81.50 %
New LR:0.000714737166709
Epoch 87 of 90 took 14.508m
  training loss:		1.200717
  validation loss:		2.088463
  validation accuracy:		59.02 %
 top 5 validation accuracy:		81.42 %
New LR:0.000711163479427
Epoch 88 of 90 took 14.513m
  training loss:		1.198912
  validation loss:		2.080859
  validation accuracy:		59.14 %
 top 5 validation accuracy:		81.66 %
New LR:0.000707607688382
Epoch 89 of 90 took 14.448m
  training loss:		1.197825
  validation loss:		2.078499
  validation accuracy:		59.12 %
 top 5 validation accuracy:		81.74 %
New LR:0.00070406967774
Epoch 90 of 90 took 14.508m
  training loss:		1.196529
  validation loss:		2.070849
  validation accuracy:		59.22 %
 top 5 validation accuracy:		81.62 %
New LR:0.000700549331668
Total training time: 1306.785m
Traceback (most recent call last):
  File "cnn_resnet.py", line 520, in <module>
    main(num_epochs=epochs, **kwargs)
  File "cnn_resnet.py", line 481, in main
    err, acc = val_fn(inputs, targets)
ValueError: too many values to unpack
